<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Twitter Heat</title>
  <style>
  html, body, #map-canvas {
    height: 100%;
    margin: 0px;
    padding: 0px
  }
  #panel {
    position: absolute;
    top: 5px;
    left: 50%;
    margin-left: -180px;
    z-index: 5;
    background-color: #fff;
    padding: 5px;
    border: 1px solid #999;
  }
  </style>
</head>
<body>
  <div id="map-canvas"></div>
  <!-- <div id="log"></div> -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js" type="text/javascript"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/0.9.16/socket.io.min.js" type="text/javascript"></script>
  <script src="https://maps.googleapis.com/maps/api/js?libraries=visualization&sensor=true_or_false?key=AIzaSyAuDjoxQgamvdu8TMzot9wT9KFJmSvXPYg" type="text/javascript"></script>
  <script>
  var map, pointarray, heatmap;
  $(function(){
    // init heat map
    var mapOptions = {
    zoom: 4,
    center: new google.maps.LatLng(37.774546, -122.433523),
      mapTypeId: google.maps.MapTypeId.ROADMAP
    };
    map = new google.maps.Map($('#map-canvas')[0], mapOptions);
    pointarray = new google.maps.MVCArray([]);
    heatmap = new google.maps.visualization.HeatmapLayer({
      data: pointarray
    });
    heatmap.setMap(map);
    // connect websocket
    namespace = '';
    var socket = io.connect('http://' + document.domain + ':' + location.port + namespace);
    socket.on('connect', function() {
      socket.emit('my event', {data: 'I\'m connected!'});
    });
    socket.on('twit', function(msg) {
      pointarray.push(new google.maps.LatLng(msg.latitude, msg.longitude));
      // console.log(msg);
    });
  });
  </script>
</body>
</html>
